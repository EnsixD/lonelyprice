(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[606],{3573:function(e,t,a){Promise.resolve().then(a.bind(a,8102))},8102:function(e,t,a){"use strict";a.d(t,{default:function(){return D}});var s=a(7437),r=a(2265);a(3079);var n=a(2119),l=(0,n.$)("26dfc3bfcfaed3f6043c14f39ced58ca7dddc17f"),i=(0,n.$)("3d29c934e519da0ffa73babd6df777f15ef888d6"),d=(0,n.$)("6ab766cd8a0768308344db243b354c368dbdd2ed"),c=a(2869),o=a(6070),u=a(3578),x=a(5974),m=a(4794),f=a(1671),h=a(9388),p=a(8226),b=a(2369),g=a(9345),v=a(3417),j=a(1817),N=a(8930),w=a(6865),y=a(5080),k=a(7276),_=a(307),T=a(4508);function C(e){let{...t}=e;return(0,s.jsx)(_.fC,{"data-slot":"alert-dialog",...t})}function Z(e){let{...t}=e;return(0,s.jsx)(_.xz,{"data-slot":"alert-dialog-trigger",...t})}function z(e){let{...t}=e;return(0,s.jsx)(_.h_,{"data-slot":"alert-dialog-portal",...t})}function H(e){let{className:t,...a}=e;return(0,s.jsx)(_.aV,{"data-slot":"alert-dialog-overlay",className:(0,T.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function A(e){let{className:t,...a}=e;return(0,s.jsxs)(z,{children:[(0,s.jsx)(H,{}),(0,s.jsx)(_.VY,{"data-slot":"alert-dialog-content",className:(0,T.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a})]})}function O(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-dialog-header",className:(0,T.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function S(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"alert-dialog-footer",className:(0,T.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function R(e){let{className:t,...a}=e;return(0,s.jsx)(_.Dx,{"data-slot":"alert-dialog-title",className:(0,T.cn)("text-lg font-semibold",t),...a})}function U(e){let{className:t,...a}=e;return(0,s.jsx)(_.dk,{"data-slot":"alert-dialog-description",className:(0,T.cn)("text-muted-foreground text-sm",t),...a})}function V(e){let{className:t,...a}=e;return(0,s.jsx)(_.aU,{className:(0,T.cn)((0,c.d)(),t),...a})}function Y(e){let{className:t,...a}=e;return(0,s.jsx)(_.$j,{className:(0,T.cn)((0,c.d)({variant:"outline"}),t),...a})}var $=a(4438);function D(e){let{orders:t}=e;return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"mb-6 sm:mb-8",children:[(0,s.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Управление заказами"}),(0,s.jsxs)("p",{className:"text-muted-foreground mt-1 text-sm sm:text-base",children:["Все заказы системы (",t.length,")"]})]}),0===t.length?(0,s.jsx)(o.Zb,{className:"bg-card/50 backdrop-blur-sm border-border/50",children:(0,s.jsxs)(o.aY,{className:"flex flex-col items-center justify-center py-12",children:[(0,s.jsx)(m.Z,{className:"w-16 h-16 text-muted-foreground/50 mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Заказов пока нет"}),(0,s.jsx)("p",{className:"text-muted-foreground text-center",children:"Как только пользователи начнут создавать заказы, они появятся здесь"})]})}):(0,s.jsx)(E,{orders:t})]})}function E(e){let{orders:t}=e,[a,n]=(0,r.useState)(null),[i,d]=(0,r.useState)(t),_=e=>{let t={pending:{variant:"secondary",label:"Ожидает",icon:(0,s.jsx)(m.Z,{className:"w-3 h-3 mr-1"})},processing:{variant:"default",label:"Обработка",icon:(0,s.jsx)(m.Z,{className:"w-3 h-3 mr-1"})},completed:{variant:"outline",label:"Завершен",icon:(0,s.jsx)(f.Z,{className:"w-3 h-3 mr-1"})},cancelled:{variant:"destructive",label:"Отменен",icon:(0,s.jsx)(h.Z,{className:"w-3 h-3 mr-1"})}};return t[e]||t.pending},T=e=>{let t={unpaid:{variant:"destructive",label:"Не оплачен",icon:(0,s.jsx)(p.Z,{className:"w-3 h-3 mr-1"})},pending:{variant:"secondary",label:"Ожидает оплаты",icon:(0,s.jsx)(p.Z,{className:"w-3 h-3 mr-1"})},paid:{variant:"outline",label:"Оплачен",icon:(0,s.jsx)(f.Z,{className:"w-3 h-3 mr-1"})},refunded:{variant:"secondary",label:"Возврат",icon:(0,s.jsx)(p.Z,{className:"w-3 h-3 mr-1"})}};return t[e]||t.unpaid},z=e=>"cancelled"!==e.status&&"completed"!==e.status,H=async e=>{n(e);try{let t=await l(e);t.success?($.A.success(t.message||"Заказ успешно удален"),d(t=>t.filter(t=>t.id!==e))):$.A.error(t.message||"Ошибка при удалении заказа")}catch(e){$.A.error(e.message||"Ошибка при удалении заказа")}finally{n(null)}},D=e=>{var t,a;return(null===(t=e.profiles)||void 0===t?void 0:t.full_name)?e.profiles.full_name:(null===(a=e.user_profile)||void 0===a?void 0:a.full_name)?e.user_profile.full_name:"Без имени"},E=e=>{var t,a;return(null===(t=e.profiles)||void 0===t?void 0:t.email)?e.profiles.email:(null===(a=e.user_profile)||void 0===a?void 0:a.email)?e.user_profile.email:"Нет email"};return(0,s.jsxs)(o.Zb,{className:"bg-card/50 backdrop-blur-sm border-border/50",children:[(0,s.jsx)(o.Ol,{className:"p-4 sm:p-6",children:(0,s.jsx)(o.ll,{children:"Список заказов"})}),(0,s.jsx)(o.aY,{className:"p-4 sm:p-6 pt-0",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)(u.Table,{className:"min-w-full",children:[(0,s.jsx)(u.TableHeader,{children:(0,s.jsxs)(u.TableRow,{children:[(0,s.jsx)(u.TableHead,{className:"whitespace-nowrap",children:"ID"}),(0,s.jsx)(u.TableHead,{className:"whitespace-nowrap",children:"Клиент"}),(0,s.jsx)(u.TableHead,{className:"whitespace-nowrap",children:"Сумма"}),(0,s.jsx)(u.TableHead,{className:"whitespace-nowrap",children:"Статус"}),(0,s.jsx)(u.TableHead,{className:"whitespace-nowrap",children:"Оплата"}),(0,s.jsx)(u.TableHead,{className:"whitespace-nowrap",children:"Создан"}),(0,s.jsx)(u.TableHead,{className:"text-right whitespace-nowrap",children:"Действия"})]})}),(0,s.jsx)(u.TableBody,{children:i.map(e=>{let t=_(e.status),r=T(e.payment_status),n=z(e);return(0,s.jsxs)(u.TableRow,{className:"hover:bg-muted/50",children:[(0,s.jsx)(u.TableCell,{className:"font-mono font-medium",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2",children:[(0,s.jsxs)("span",{className:"text-xs sm:text-sm",children:["#",e.id.slice(0,8)]}),("cancelled"===e.status||"completed"===e.status)&&(0,s.jsx)(x.C,{variant:"outline",className:"text-xs w-fit",children:"Архив"})]})}),(0,s.jsx)(u.TableCell,{children:(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(b.Z,{className:"w-3 h-3 text-muted-foreground"}),(0,s.jsx)("div",{className:"font-medium text-sm",children:D(e)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(g.Z,{className:"w-3 h-3 text-muted-foreground"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:E(e)})]})]})}),(0,s.jsxs)(u.TableCell,{className:"font-bold text-sm sm:text-base",children:[e.total_amount.toLocaleString("ru-RU")," ₽"]}),(0,s.jsx)(u.TableCell,{children:(0,s.jsxs)("div",{className:"flex flex-col gap-1 sm:gap-2",children:[(0,s.jsxs)(x.C,{variant:t.variant,className:"gap-1 text-xs w-fit",children:[t.icon,t.label]}),(0,s.jsx)(B,{order:e,onUpdate:t=>{d(a=>a.map(a=>a.id===e.id?{...a,status:t}:a))}})]})}),(0,s.jsx)(u.TableCell,{children:(0,s.jsxs)("div",{className:"flex flex-col gap-1 sm:gap-2",children:[(0,s.jsxs)(x.C,{variant:r.variant,className:"gap-1 text-xs w-fit",children:[r.icon,r.label]}),(0,s.jsx)(W,{order:e,onUpdate:t=>{d(a=>a.map(a=>a.id===e.id?{...a,payment_status:t}:a))}})]})}),(0,s.jsx)(u.TableCell,{className:"text-xs sm:text-sm text-muted-foreground",children:(0,y.Q)(new Date(e.created_at),{addSuffix:!0,locale:k.ru})}),(0,s.jsx)(u.TableCell,{className:"text-right",children:(0,s.jsxs)("div",{className:"flex justify-end gap-1 sm:gap-2",children:[(0,s.jsx)(c.z,{asChild:!0,size:"sm",variant:"outline",className:"h-8 w-8 sm:h-9 sm:w-9 p-0",title:n?"Перейти в чат заказа":"Чат недоступен для завершенных/отмененных заказов",children:(0,s.jsx)("a",{href:"/orders/".concat(e.id),children:(0,s.jsx)(v.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"})})}),(0,s.jsxs)(C,{children:[(0,s.jsx)(Z,{asChild:!0,children:(0,s.jsx)(c.z,{size:"sm",variant:"ghost",className:"h-8 w-8 sm:h-9 sm:w-9 p-0 text-red-500 hover:text-red-600 hover:bg-red-50",disabled:a===e.id,title:"Удалить заказ",children:a===e.id?(0,s.jsx)(j.Z,{className:"w-3 h-3 sm:w-4 sm:h-4 animate-spin"}):(0,s.jsx)(N.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"})})}),(0,s.jsxs)(A,{className:"max-w-[95vw] sm:max-w-md",children:[(0,s.jsxs)(O,{children:[(0,s.jsxs)(R,{className:"flex items-center gap-2",children:[(0,s.jsx)(w.Z,{className:"w-5 h-5 text-red-500"}),"Удаление заказа"]}),(0,s.jsxs)(U,{className:"text-sm",children:["Вы уверены, что хотите удалить заказ #",e.id.slice(0,8),"?",(0,s.jsxs)("div",{className:"mt-2 p-2 bg-red-50 rounded text-sm",children:[(0,s.jsx)("strong",{children:"Будет удалено:"}),(0,s.jsxs)("ul",{className:"list-disc ml-4 mt-1 space-y-1",children:[(0,s.jsx)("li",{children:"Данные заказа"}),(0,s.jsx)("li",{children:"Товары в заказе"}),(0,s.jsx)("li",{children:"История сообщений в чате"})]})]}),(0,s.jsx)("p",{className:"mt-2 text-red-600 font-semibold",children:"Это действие невозможно отменить!"})]})]}),(0,s.jsxs)(S,{className:"flex flex-col sm:flex-row gap-2",children:[(0,s.jsx)(Y,{className:"mt-0",children:"Отмена"}),(0,s.jsx)(V,{onClick:()=>H(e.id),className:"bg-red-600 hover:bg-red-700",disabled:a===e.id,children:a===e.id?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Удаление..."]}):"Удалить заказ"})]})]})]})]})})]},e.id)})})]})})})]})}function B(e){let{order:t,onUpdate:a}=e,[n,l]=(0,r.useOptimistic)(t.status,(e,t)=>t),d=async e=>{l(e),a&&a(e);try{await i(t.id,e),$.A.success("Статус заказа изменен на: ".concat("pending"===e?"Ожидает":"processing"===e?"В обработке":"completed"===e?"Завершен":"Отменен"))}catch(e){$.A.error("Ошибка при изменении статуса")}};return(0,s.jsxs)("select",{value:n,onChange:e=>d(e.target.value),className:"w-full border rounded px-2 py-1 text-xs bg-background cursor-pointer",children:[(0,s.jsx)("option",{value:"pending",children:"Ожидает"}),(0,s.jsx)("option",{value:"processing",children:"В обработке"}),(0,s.jsx)("option",{value:"completed",children:"Завершен"}),(0,s.jsx)("option",{value:"cancelled",children:"Отменен"})]})}function W(e){let{order:t,onUpdate:a}=e,[n,l]=(0,r.useOptimistic)(t.payment_status,(e,t)=>t),i=async e=>{l(e),a&&a(e);try{await d(t.id,e),$.A.success("Статус оплаты изменен на: ".concat("unpaid"===e?"Не оплачен":"pending"===e?"Ожидает оплаты":"paid"===e?"Оплачен":"Возврат"))}catch(e){$.A.error("Ошибка при изменении статуса оплаты")}};return(0,s.jsxs)("select",{value:n,onChange:e=>i(e.target.value),className:"w-full border rounded px-2 py-1 text-xs bg-background cursor-pointer",children:[(0,s.jsx)("option",{value:"unpaid",children:"Не оплачен"}),(0,s.jsx)("option",{value:"pending",children:"Ожидает оплаты"}),(0,s.jsx)("option",{value:"paid",children:"Оплачен"}),(0,s.jsx)("option",{value:"refunded",children:"Возврат"})]})}},5974:function(e,t,a){"use strict";a.d(t,{C:function(){return d}});var s=a(7437);a(2265);var r=a(7053),n=a(535),l=a(4508);let i=(0,n.j)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function d(e){let{className:t,variant:a,asChild:n=!1,...d}=e,c=n?r.g7:"span";return(0,s.jsx)(c,{"data-slot":"badge",className:(0,l.cn)(i({variant:a}),t),...d})}},2869:function(e,t,a){"use strict";a.d(t,{d:function(){return i},z:function(){return d}});var s=a(7437);a(2265);var r=a(7053),n=a(535),l=a(4508);let i=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function d(e){let{className:t,variant:a,size:n,asChild:d=!1,...c}=e,o=d?r.g7:"button";return(0,s.jsx)(o,{"data-slot":"button",className:(0,l.cn)(i({variant:a,size:n,className:t})),...c})}},6070:function(e,t,a){"use strict";a.d(t,{Ol:function(){return l},SZ:function(){return d},Zb:function(){return n},aY:function(){return c},eW:function(){return o},ll:function(){return i}});var s=a(7437);a(2265);var r=a(4508);function n(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function l(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function i(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",t),...a})}function d(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...a})}function c(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",t),...a})}function o(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-footer",className:(0,r.cn)("flex items-center px-6 [.border-t]:pt-6",t),...a})}},3578:function(e,t,a){"use strict";a.d(t,{Table:function(){return n},TableBody:function(){return i},TableCell:function(){return o},TableHead:function(){return c},TableHeader:function(){return l},TableRow:function(){return d}});var s=a(7437);a(2265);var r=a(4508);function n(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,s.jsx)("table",{"data-slot":"table",className:(0,r.cn)("w-full caption-bottom text-sm",t),...a})})}function l(e){let{className:t,...a}=e;return(0,s.jsx)("thead",{"data-slot":"table-header",className:(0,r.cn)("[&_tr]:border-b",t),...a})}function i(e){let{className:t,...a}=e;return(0,s.jsx)("tbody",{"data-slot":"table-body",className:(0,r.cn)("[&_tr:last-child]:border-0",t),...a})}function d(e){let{className:t,...a}=e;return(0,s.jsx)("tr",{"data-slot":"table-row",className:(0,r.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function c(e){let{className:t,...a}=e;return(0,s.jsx)("th",{"data-slot":"table-head",className:(0,r.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function o(e){let{className:t,...a}=e;return(0,s.jsx)("td",{"data-slot":"table-cell",className:(0,r.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}},4508:function(e,t,a){"use strict";a.d(t,{cn:function(){return n}});var s=a(1994),r=a(3335);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.m6)((0,s.W)(t))}}},function(e){e.O(0,[137,172,122,438,975,570,971,117,744],function(){return e(e.s=3573)}),_N_E=e.O()}]);