(()=>{var e={};e.id=674,e.ids=[674],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},82098:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>c,routeModule:()=>u,tree:()=>o}),r(1309),r(75016),r(11506),r(35866);var s=r(23191),a=r(88716),n=r(37922),i=r.n(n),l=r(95231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);r.d(t,d);let o=["",{children:["admin",{children:["users",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,1309)),"/home/ensi/Projects/lonlyprice/app/admin/users/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,75016)),"/home/ensi/Projects/lonlyprice/app/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,11506)),"/home/ensi/Projects/lonlyprice/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],c=["/home/ensi/Projects/lonlyprice/app/admin/users/page.tsx"],m="/admin/users/page",x={require:r,loadChunk:()=>Promise.resolve()},u=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/users/page",pathname:"/admin/users",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},77021:(e,t,r)=>{let s={"1b5f129ec54760fc14fdf1a5b321d3163f7d9cff":()=>Promise.resolve().then(r.bind(r,1309)).then(e=>e.$$ACTION_0),"9df65e6a976776504b60c3f4ad5dcdeb473e9e45":()=>Promise.resolve().then(r.bind(r,1309)).then(e=>e.$$ACTION_1)};async function a(e,...t){return(await s[e]()).apply(null,t)}e.exports={"1b5f129ec54760fc14fdf1a5b321d3163f7d9cff":a.bind(null,"1b5f129ec54760fc14fdf1a5b321d3163f7d9cff"),"9df65e6a976776504b60c3f4ad5dcdeb473e9e45":a.bind(null,"9df65e6a976776504b60c3f4ad5dcdeb473e9e45")}},37757:(e,t,r)=>{Promise.resolve().then(r.bind(r,58023)),Promise.resolve().then(r.t.bind(r,92481,23)),Promise.resolve().then(r.t.bind(r,79404,23)),Promise.resolve().then(r.bind(r,85999)),Promise.resolve().then(r.bind(r,30656))},33287:(e,t,r)=>{Promise.resolve().then(r.bind(r,15940))},15940:(e,t,r)=>{"use strict";r.d(t,{Table:()=>n,TableBody:()=>l,TableCell:()=>c,TableHead:()=>o,TableHeader:()=>i,TableRow:()=>d});var s=r(10326);r(17577);var a=r(77863);function n({className:e,...t}){return s.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:s.jsx("table",{"data-slot":"table",className:(0,a.cn)("w-full caption-bottom text-sm",e),...t})})}function i({className:e,...t}){return s.jsx("thead",{"data-slot":"table-header",className:(0,a.cn)("[&_tr]:border-b",e),...t})}function l({className:e,...t}){return s.jsx("tbody",{"data-slot":"table-body",className:(0,a.cn)("[&_tr:last-child]:border-0",e),...t})}function d({className:e,...t}){return s.jsx("tr",{"data-slot":"table-row",className:(0,a.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...t})}function o({className:e,...t}){return s.jsx("th",{"data-slot":"table-head",className:(0,a.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}function c({className:e,...t}){return s.jsx("td",{"data-slot":"table-cell",className:(0,a.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}},75016:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var s=r(19510),a=r(57371),n=r(2946),i=r(68570);let l=(0,i.createProxy)(String.raw`/home/ensi/Projects/lonlyprice/node_modules/sonner/dist/index.mjs#Toaster`);(0,i.createProxy)(String.raw`/home/ensi/Projects/lonlyprice/node_modules/sonner/dist/index.mjs#toast`),(0,i.createProxy)(String.raw`/home/ensi/Projects/lonlyprice/node_modules/sonner/dist/index.mjs#useSonner`);var d=r(19692),o=r(58585),c=r(17710),m=r(56842),x=r(74888);async function u({children:e}){let t=await (0,d.e)(),{data:{user:r}}=await t.auth.getUser();r||(0,o.redirect)("/auth/login");let{data:i}=await t.from("profiles").select("is_admin").eq("id",r.id).single();i?.is_admin||(0,o.redirect)("/");let{count:u}=await t.from("cart_items").select("*",{count:"exact",head:!0}).eq("user_id",r.id);return(0,s.jsxs)("div",{className:"min-h-screen",children:[s.jsx("div",{className:"border-b border-border/40 bg-background/80 backdrop-blur-xl sticky top-0 z-50 supports-[backdrop-filter]:bg-background/60",children:s.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 py-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(x.z,{user:r,cartCount:u||0,isAdmin:i?.is_admin||!1}),(0,s.jsxs)(a.default,{href:"/",className:"flex items-center gap-2 sm:gap-3 hover:opacity-80 transition-opacity",children:[s.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 rounded-lg bg-primary/10 flex items-center justify-center",children:s.jsx(c.default,{src:m.Z,alt:"Lonely Price",width:500,height:300,priority:!0,className:"rounded-[50%]"})}),s.jsx("span",{className:"text-base sm:text-lg font-bold",children:"Lonely PRICE"})]})]}),(0,s.jsxs)("div",{className:"hidden md:flex items-center gap-4 lg:gap-6",children:[(0,s.jsxs)("nav",{className:"flex gap-3 lg:gap-4",children:[s.jsx(a.default,{href:"/admin",className:"text-sm font-medium text-muted-foreground hover:text-foreground transition-colors px-2 py-1 rounded hover:bg-accent",children:"Панель управления"}),s.jsx(a.default,{href:"/admin/users",className:"text-sm font-medium text-muted-foreground hover:text-foreground transition-colors px-2 py-1 rounded hover:bg-accent",children:"Пользователи"}),s.jsx(a.default,{href:"/admin/services",className:"text-sm font-medium text-muted-foreground hover:text-foreground transition-colors px-2 py-1 rounded hover:bg-accent",children:"Услуги"}),s.jsx(a.default,{href:"/admin/orders",className:"text-sm font-medium text-muted-foreground hover:text-foreground transition-colors px-2 py-1 rounded hover:bg-accent",children:"Заказы"})]}),s.jsx(n.z,{asChild:!0,variant:"outline",size:"sm",className:"cursor-pointer",children:s.jsx(a.default,{href:"/services",children:"Вернуться к сайту"})})]}),s.jsx("div",{className:"flex md:hidden items-center gap-2",children:s.jsx(n.z,{asChild:!0,variant:"outline",size:"sm",className:"cursor-pointer text-xs px-2",children:s.jsx(a.default,{href:"/services",children:"На сайт"})})})]})})}),s.jsx("main",{className:"flex-1",children:s.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 py-6 sm:py-8",children:e})}),s.jsx("div",{className:"border-t border-border/40 py-6 mt-96",children:s.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center",children:s.jsx(c.default,{src:m.Z,alt:"Lonely Price",width:500,height:300,priority:!0,className:"rounded-[50%]"})}),s.jsx("span",{className:"text-sm font-medium",children:"Lonely PRICE"})]}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground text-center sm:text-right",children:["\xa9 ",new Date().getFullYear()," Админ-панель. Все права защищены."]})]})})}),s.jsx(l,{position:"top-right"})]})}},1309:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$ACTION_0:()=>_,$$ACTION_1:()=>C,default:()=>P});var s=r(19510),a=r(24330);r(60166);var n=r(19692),i=r(58585),l=r(2946),d=r(46697),o=r(18897),c=r(68570);let m=(0,c.createProxy)(String.raw`/home/ensi/Projects/lonlyprice/components/ui/table.tsx#Table`),x=(0,c.createProxy)(String.raw`/home/ensi/Projects/lonlyprice/components/ui/table.tsx#TableHeader`),u=(0,c.createProxy)(String.raw`/home/ensi/Projects/lonlyprice/components/ui/table.tsx#TableBody`);(0,c.createProxy)(String.raw`/home/ensi/Projects/lonlyprice/components/ui/table.tsx#TableFooter`);let h=(0,c.createProxy)(String.raw`/home/ensi/Projects/lonlyprice/components/ui/table.tsx#TableHead`),p=(0,c.createProxy)(String.raw`/home/ensi/Projects/lonlyprice/components/ui/table.tsx#TableRow`),f=(0,c.createProxy)(String.raw`/home/ensi/Projects/lonlyprice/components/ui/table.tsx#TableCell`);(0,c.createProxy)(String.raw`/home/ensi/Projects/lonlyprice/components/ui/table.tsx#TableCaption`);var b=r(27162);let g=(0,b.Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);var v=r(83218);let j=(0,b.Z)("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]),y=(0,b.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var A=r(99437),w=r(34215);let N=()=>{if(!process.env.SUPABASE_SERVICE_ROLE_KEY)throw Error("SUPABASE_SERVICE_ROLE_KEY не настроен в .env.local");let{createClient:e}=r(92445);return e("https://lvjmvxhppvssyhryjaal.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})};async function P(){let e=await (0,n.e)(),{data:{user:t}}=await e.auth.getUser();t||(0,i.redirect)("/auth/login");let{data:r}=await e.from("profiles").select("*").eq("id",t.id).single();r?.is_admin||(0,i.redirect)("/");let{data:c}=await e.from("profiles").select("*").order("created_at",{ascending:!1}),b=(0,a.j)("1b5f129ec54760fc14fdf1a5b321d3163f7d9cff",_),N=(0,a.j)("9df65e6a976776504b60c3f4ad5dcdeb473e9e45",C);return s.jsx("div",{className:"min-h-screen bg-transparent",children:(0,s.jsxs)("div",{className:"mx-auto max-w-7xl px-6 py-12",children:[(0,s.jsxs)("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Управление пользователями"}),(0,s.jsxs)("p",{className:"text-muted-foreground mt-2",children:["Всего пользователей: ",c?.length||0]})]}),(0,s.jsxs)(d.Zb,{children:[s.jsx(d.Ol,{children:s.jsx(d.ll,{children:"Список пользователей"})}),s.jsx(d.aY,{children:(0,s.jsxs)(m,{children:[s.jsx(x,{children:(0,s.jsxs)(p,{children:[s.jsx(h,{children:"Пользователь"}),s.jsx(h,{children:"Email"}),s.jsx(h,{children:"Роль"}),s.jsx(h,{children:"Статус"}),s.jsx(h,{children:"Регистрация"}),s.jsx(h,{children:"Действия"})]})}),s.jsx(u,{children:c?.map(e=>s.jsxs(p,{children:[s.jsx(f,{className:"font-medium",children:e.full_name||"Без имени"}),s.jsx(f,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(g,{className:"w-4 h-4 text-muted-foreground"}),e.email]})}),s.jsx(f,{children:e.is_admin?s.jsxs(o.C,{className:"gap-1",children:[s.jsx(v.Z,{className:"w-3 h-3"}),"Админ"]}):s.jsx(o.C,{variant:"secondary",children:"Пользователь"})}),s.jsx(f,{children:e.is_blocked?s.jsx(o.C,{variant:"destructive",children:"Заблокирован"}):s.jsx(o.C,{variant:"default",children:"Активен"})}),s.jsx(f,{className:"text-sm text-muted-foreground",children:A.Q(new Date(e.created_at),{addSuffix:!0,locale:w.ru})}),s.jsx(f,{children:s.jsx("div",{className:"flex items-center gap-2",children:!e.is_admin&&s.jsxs(s.Fragment,{children:[s.jsx("form",{action:b.bind(null,e.id,e.is_blocked),children:s.jsxs(l.z,{variant:"outline",size:"sm",type:"submit",children:[s.jsx(j,{className:"w-4 h-4 mr-1"}),e.is_blocked?"Разблокировать":"Блокировать"]})}),s.jsx("form",{action:N.bind(null,e.id),children:s.jsxs(l.z,{variant:"destructive",size:"sm",type:"submit",children:[s.jsx(y,{className:"w-4 h-4 mr-1"}),"Удалить"]})})]})})})]},e.id))})]})})]})]})})}async function _(e,t){let r=await (0,n.e)();await r.from("profiles").update({is_blocked:!t}).eq("id",e),(0,i.redirect)("/admin/users")}async function C(e){try{let t=N(),{error:r}=await t.auth.admin.deleteUser(e);if(r){if(r.message.includes("still referenced")){let t=await (0,n.e)();await t.from("profiles").delete().eq("id",e),(0,i.redirect)("/admin/users?message=Пользователь частично удален (удален только профиль)")}throw Error(`Не удалось удалить пользователя: ${r.message}`)}(0,i.redirect)("/admin/users?message=Пользователь успешно удален")}catch(e){(0,i.redirect)(`/admin/users?error=${encodeURIComponent(e.message||"Неизвестная ошибка")}`)}}},18897:(e,t,r)=>{"use strict";r.d(t,{C:()=>d});var s=r(19510);r(71159);var a=r(43025),n=r(46145),i=r(50650);let l=(0,n.j)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function d({className:e,variant:t,asChild:r=!1,...n}){let d=r?a.g7:"span";return s.jsx(d,{"data-slot":"badge",className:(0,i.cn)(l({variant:t}),e),...n})}},46697:(e,t,r)=>{"use strict";r.d(t,{Ol:()=>i,SZ:()=>d,Zb:()=>n,aY:()=>o,eW:()=>c,ll:()=>l});var s=r(19510);r(71159);var a=r(50650);function n({className:e,...t}){return s.jsx("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...t})}function i({className:e,...t}){return s.jsx("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...t})}function l({className:e,...t}){return s.jsx("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...t})}function d({className:e,...t}){return s.jsx("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",e),...t})}function o({className:e,...t}){return s.jsx("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...t})}function c({className:e,...t}){return s.jsx("div",{"data-slot":"card-footer",className:(0,a.cn)("flex items-center px-6 [.border-t]:pt-6",e),...t})}},56842:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s={src:"/_next/static/media/logo.1e858ee9.png",height:1024,width:1024,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAHlBMVEX//v/w8PDMzMz4+Pi1tbWFhYWfn59ubm4PDw+Xl5cWOcINAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAKUlEQVR4nGNgwATMTIwQBgsrCwOYycrBzsLGxMDAwMTJxMwIlYWpBlMACXYASgctBm8AAAAASUVORK5CYII=",blurWidth:8,blurHeight:8}},30656:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s={src:"/_next/static/media/logo.1e858ee9.png",height:1024,width:1024,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAHlBMVEX//v/w8PDMzMz4+Pi1tbWFhYWfn59ubm4PDw+Xl5cWOcINAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAKUlEQVR4nGNgwATMTIwQBgsrCwOYycrBzsLGxMDAwMTJxMwIlYWpBlMACXYASgctBm8AAAAASUVORK5CYII=",blurWidth:8,blurHeight:8}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,438,959,404,711,741,590,710,999,877,926,127],()=>r(82098));module.exports=s})();