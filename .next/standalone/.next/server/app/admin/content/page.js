(()=>{var e={};e.id=975,e.ids=[975],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1505:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>u,tree:()=>c}),s(16694),s(90596),s(11506),s(35866);var a=s(23191),r=s(88716),n=s(37922),l=s.n(n),i=s(95231),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);s.d(t,d);let c=["",{children:["admin",{children:["content",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,16694)),"/home/ensi/Projects/lonlyprice/app/admin/content/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,90596)),"/home/ensi/Projects/lonlyprice/app/admin/layout.tsx"],metadata:{icon:[],apple:[],openGraph:[],twitter:[],manifest:"/manifest.webmanifest"}}]},{layout:[()=>Promise.resolve().then(s.bind(s,11506)),"/home/ensi/Projects/lonlyprice/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[],apple:[],openGraph:[],twitter:[],manifest:"/manifest.webmanifest"}}],o=["/home/ensi/Projects/lonlyprice/app/admin/content/page.tsx"],x="/admin/content/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/admin/content/page",pathname:"/admin/content",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},30927:(e,t,s)=>{Promise.resolve().then(s.bind(s,95264))},95264:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>k});var a=s(10326),r=s(17577),n=s(42945),l=s(35047),i=s(90772),d=s(33071),c=s(15940),o=s(567),x=s(54432),m=s(87673),u=s(45842),h=s(62288),p=s(62881);let j=(0,p.Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var f=s(83855),g=s(36283);let v=(0,p.Z)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),N=(0,p.Z)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var b=s(69508),y=s(98091),w=s(85999),_=s(99440);function k(){let e=(0,l.useRouter)(),[t,s]=(0,r.useState)([]),[p,k]=(0,r.useState)(null),[T,C]=(0,r.useState)(!1),[P,S]=(0,r.useState)(!1),[z,q]=(0,r.useState)(null),[A,Z]=(0,r.useState)(!1),[O,M]=(0,r.useState)(null),[V,H]=(0,r.useState)(null),[J,Y]=(0,r.useState)(!1),R=async()=>{let t=(0,n.e)(),{data:{user:a}}=await t.auth.getUser();if(!a){e.push("/auth/login");return}M(a);let{data:r}=await t.from("profiles").select("*").eq("id",a.id).single();r&&H(r);let{data:l,error:i}=await t.from("terms_content").select("*").order("order_index");if(i){w.A.error(`Ошибка загрузки: ${i.message}`);return}l&&s(l.map(e=>{let t;try{t="string"==typeof e.content?JSON.parse(e.content):e.content}catch(e){t={}}return{...e,content:t}}))},F=async e=>{let s;e.preventDefault(),Z(!0);let a=(0,n.e)(),r=new FormData(e.currentTarget),l=r.get("content");try{s=JSON.parse(l)}catch(e){w.A.error(`Неверный формат JSON: ${e.message}`),Z(!1);return}let i={title:r.get("title"),section:r.get("section"),content:JSON.stringify(s),order_index:p?.order_index||(t.length>0?Math.max(...t.map(e=>e.order_index))+1:1)};try{if(p){let{error:e}=await a.from("terms_content").update(i).eq("id",p.id);if(e)throw e;w.A.success("Раздел успешно обновлен")}else{let{error:e}=await a.from("terms_content").insert([i]);if(e)throw e;w.A.success("Раздел успешно создан")}}catch(e){w.A.error(e.message||"Ошибка при сохранении")}finally{C(!1),k(null),Z(!1),R()}},G=async()=>{if(!z)return;Z(!0);let e=(0,n.e)(),{error:t}=await e.from("terms_content").delete().eq("id",z);t?w.A.error(t.message):w.A.success("Раздел успешно удален"),S(!1),q(null),Z(!1),R()},$=(e,a)=>{let r=[...t];"up"===a&&e>0?[r[e],r[e-1]]=[r[e-1],r[e]]:"down"===a&&e<r.length-1&&([r[e],r[e+1]]=[r[e+1],r[e]]),s(r.map((e,t)=>({...e,order_index:t+1})))},D=async()=>{Y(!0);let e=(0,n.e)();try{for(let s of t.map((e,t)=>({id:e.id,order_index:t+1}))){let{error:t}=await e.from("terms_content").update({order_index:s.order_index}).eq("id",s.id);if(t)throw t}w.A.success("Порядок разделов сохранен")}catch(e){w.A.error(e.message||"Ошибка при сохранении порядка")}finally{Y(!1)}},E=e=>({services:"Услуги",partnership:"Партнерство",nuances:"Нюансы",prices:"Цены",important:"Примечание"})[e]||e,U=e=>({services:"bg-blue-100 text-blue-800",partnership:"bg-green-100 text-green-800",nuances:"bg-yellow-100 text-yellow-800",prices:"bg-purple-100 text-purple-800",important:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800";return O&&V?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-bold",children:"Управление условиями"}),a.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:'Редактирование разделов "Условия и соглашения"'})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.z,{variant:"outline",onClick:D,disabled:J,children:[J?a.jsx("div",{className:"w-4 h-4 mr-2 animate-spin rounded-full border-2 border-current border-t-transparent"}):a.jsx(j,{className:"w-4 h-4 mr-2"}),"Сохранить порядок"]}),(0,a.jsxs)(i.z,{onClick:()=>{k(null),C(!0)},children:[a.jsx(f.Z,{className:"w-4 h-4 mr-2"}),"Добавить раздел"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx(d.Zb,{children:(0,a.jsxs)(d.aY,{className:"p-4",children:[a.jsx("div",{className:"text-2xl font-bold",children:t.length}),a.jsx("div",{className:"text-sm text-muted-foreground",children:"Всего разделов"})]})}),a.jsx(d.Zb,{children:(0,a.jsxs)(d.aY,{className:"p-4",children:[a.jsx("div",{className:"text-2xl font-bold",children:t.filter(e=>"services"===e.section).length}),a.jsx("div",{className:"text-sm text-muted-foreground",children:"Услуги"})]})}),a.jsx(d.Zb,{children:(0,a.jsxs)(d.aY,{className:"p-4",children:[a.jsx("div",{className:"text-2xl font-bold",children:t.filter(e=>"prices"===e.section).length}),a.jsx("div",{className:"text-sm text-muted-foreground",children:"Цены"})]})}),a.jsx(d.Zb,{children:(0,a.jsxs)(d.aY,{className:"p-4",children:[a.jsx("div",{className:"text-2xl font-bold",children:t.filter(e=>"important"===e.section).length}),a.jsx("div",{className:"text-sm text-muted-foreground",children:"Примечания"})]})})]}),a.jsx(d.Zb,{children:a.jsx(d.aY,{className:"p-0",children:(0,a.jsxs)(c.Table,{children:[a.jsx(c.TableHeader,{children:(0,a.jsxs)(c.TableRow,{children:[a.jsx(c.TableHead,{className:"w-16",children:"Порядок"}),a.jsx(c.TableHead,{className:"w-12",children:"#"}),a.jsx(c.TableHead,{children:"Название раздела"}),a.jsx(c.TableHead,{children:"Тип"}),a.jsx(c.TableHead,{className:"w-48",children:"Действия"})]})}),a.jsx(c.TableBody,{children:0===t.length?a.jsx(c.TableRow,{children:a.jsx(c.TableCell,{colSpan:5,className:"text-center py-8",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[a.jsx(g.Z,{className:"w-12 h-12 text-muted-foreground/50"}),a.jsx("p",{className:"text-muted-foreground",children:"Разделы не найдены"}),(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>{k(null),C(!0)},children:[a.jsx(f.Z,{className:"w-3 h-3 mr-1"}),"Создать первый раздел"]})]})})}):t.map((e,s)=>(0,a.jsxs)(c.TableRow,{children:[a.jsx(c.TableCell,{children:(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[a.jsx(i.z,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>$(s,"up"),disabled:0===s,children:a.jsx(v,{className:"w-3 h-3"})}),a.jsx(i.z,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>$(s,"down"),disabled:s===t.length-1,children:a.jsx(N,{className:"w-3 h-3"})})]})}),a.jsx(c.TableCell,{children:a.jsx("div",{className:"font-mono text-sm",children:e.order_index})}),a.jsx(c.TableCell,{children:(0,a.jsxs)("div",{children:[a.jsx("div",{className:"font-medium",children:e.title}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground truncate max-w-md",children:[e.content.paragraphs?.[0]?.substring(0,100)||"Нет описания","..."]})]})}),a.jsx(c.TableCell,{children:a.jsx(o.C,{className:U(e.section),children:E(e.section)})}),a.jsx(c.TableCell,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.z,{size:"sm",variant:"outline",onClick:()=>{k(e),C(!0)},children:[a.jsx(b.Z,{className:"w-3 h-3 mr-1"}),"Изменить"]}),(0,a.jsxs)(i.z,{size:"sm",variant:"destructive",onClick:()=>{q(e.id),S(!0)},children:[a.jsx(y.Z,{className:"w-3 h-3 mr-1"}),"Удалить"]})]})})]},e.id))})]})})}),a.jsx(h.Vq,{open:T,onOpenChange:C,children:(0,a.jsxs)(h.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(h.fK,{children:[a.jsx(h.$N,{children:p?"Редактирование раздела":"Создание нового раздела"}),a.jsx(h.Be,{children:p?"Измените информацию о разделе":"Заполните информацию для нового раздела"})]}),(0,a.jsxs)("form",{onSubmit:F,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(u._,{htmlFor:"title",children:"Название раздела *"}),a.jsx(x.I,{id:"title",name:"title",defaultValue:p?.title||"",placeholder:"Например: Общие положения",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(u._,{htmlFor:"section",children:"Тип раздела *"}),(0,a.jsxs)("select",{id:"section",name:"section",defaultValue:p?.section||"services",className:"w-full h-10 border rounded-md px-3 bg-background",required:!0,children:[a.jsx("option",{value:"services",children:"Услуги"}),a.jsx("option",{value:"partnership",children:"Партнерство"}),a.jsx("option",{value:"nuances",children:"Нюансы"}),a.jsx("option",{value:"prices",children:"Цены"}),a.jsx("option",{value:"important",children:"Примечание"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx(u._,{htmlFor:"content",children:"Содержимое раздела (JSON) *"}),a.jsx("div",{className:"text-xs text-muted-foreground",children:"Используйте JSON формат"})]}),(0,a.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[a.jsx("div",{className:"bg-muted px-4 py-2 text-sm font-medium",children:"Структура JSON:"}),a.jsx(m.g,{id:"content",name:"content",className:"h-64 font-mono text-sm",defaultValue:JSON.stringify(p?.content||{paragraphs:["Введите текст первого параграфа здесь.","Введите текст второго параграфа здесь."],lists:[{title:"Заголовок списка (опционально)",items:["Пункт 1","Пункт 2","Пункт 3"]}],prices:[{name:"Название услуги",value:"Стоимость"}]},null,2),required:!0,spellCheck:"false"})]}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground space-y-2",children:[a.jsx("p",{className:"font-medium",children:"Примеры использования:"}),a.jsx("pre",{className:"text-xs bg-muted p-2 rounded",children:`// Только параграфы:
{
  "paragraphs": ["Текст параграфа 1", "Текст параграфа 2"]
}

// Списки:
{
  "lists": [{
    "title": "Основные правила",
    "items": ["Правило 1", "Правило 2"]
  }]
}

// Цены:
{
  "prices": [{
    "name": "Услуга 1",
    "value": "1000 ₽"
  }]
}`})]})]}),(0,a.jsxs)(h.cN,{className:"gap-2",children:[a.jsx(i.z,{type:"button",variant:"outline",onClick:()=>C(!1),children:"Отмена"}),a.jsx(i.z,{type:"submit",disabled:A,children:A?(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"w-4 h-4 mr-2 animate-spin rounded-full border-2 border-current border-t-transparent"}),"Сохранение..."]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(j,{className:"w-4 h-4 mr-2"}),p?"Сохранить изменения":"Создать раздел"]})})]})]})]})}),a.jsx(_.aR,{open:P,onOpenChange:S,children:(0,a.jsxs)(_._T,{children:[(0,a.jsxs)(_.fY,{children:[a.jsx(_.f$,{children:"Удалить раздел?"}),(0,a.jsxs)(_.yT,{children:["Вы уверены, что хотите удалить этот раздел? Это действие нельзя будет отменить.",(0,a.jsxs)("div",{className:"mt-2 p-2 bg-muted rounded",children:[a.jsx("span",{className:"font-medium",children:"Название:"})," ",t.find(e=>e.id===z)?.title]})]})]}),(0,a.jsxs)(_.xo,{children:[a.jsx(_.le,{children:"Отмена"}),a.jsx(_.OL,{onClick:G,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Удалить"})]})]})})]}):a.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}},99440:(e,t,s)=>{"use strict";s.d(t,{OL:()=>j,_T:()=>x,aR:()=>i,f$:()=>h,fY:()=>m,le:()=>f,vW:()=>d,xo:()=>u,yT:()=>p});var a=s(10326);s(17577);var r=s(64069),n=s(77863),l=s(90772);function i({...e}){return a.jsx(r.fC,{"data-slot":"alert-dialog",...e})}function d({...e}){return a.jsx(r.xz,{"data-slot":"alert-dialog-trigger",...e})}function c({...e}){return a.jsx(r.h_,{"data-slot":"alert-dialog-portal",...e})}function o({className:e,...t}){return a.jsx(r.aV,{"data-slot":"alert-dialog-overlay",className:(0,n.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...t})}function x({className:e,...t}){return(0,a.jsxs)(c,{children:[a.jsx(o,{}),a.jsx(r.VY,{"data-slot":"alert-dialog-content",className:(0,n.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e),...t})]})}function m({className:e,...t}){return a.jsx("div",{"data-slot":"alert-dialog-header",className:(0,n.cn)("flex flex-col gap-2 text-center sm:text-left",e),...t})}function u({className:e,...t}){return a.jsx("div",{"data-slot":"alert-dialog-footer",className:(0,n.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",e),...t})}function h({className:e,...t}){return a.jsx(r.Dx,{"data-slot":"alert-dialog-title",className:(0,n.cn)("text-lg font-semibold",e),...t})}function p({className:e,...t}){return a.jsx(r.dk,{"data-slot":"alert-dialog-description",className:(0,n.cn)("text-muted-foreground text-sm",e),...t})}function j({className:e,...t}){return a.jsx(r.aU,{className:(0,n.cn)((0,l.d)(),e),...t})}function f({className:e,...t}){return a.jsx(r.$j,{className:(0,n.cn)((0,l.d)({variant:"outline"}),e),...t})}},16694:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(68570).createProxy)(String.raw`/home/ensi/Projects/lonlyprice/app/admin/content/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948,959,438,404,684,470,590,710,622,604,27],()=>s(1505));module.exports=a})();